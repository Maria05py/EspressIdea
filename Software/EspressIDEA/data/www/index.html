<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EspressIdea</title>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <!-- Estilos -->
  <link rel="stylesheet" href="/styles/index.css" />
  <!-- Orquestador -->
  <script type="module" src="/js/index.js"></script>
</head>
<body>
  <!-- Overlay de carga global -->
  <div id="appLoading" class="overlay hidden" aria-hidden="true">
    <div class="spinner-lg" role="status" aria-label="Cargando"></div>
    <div class="overlay-text">Preparando dispositivo…</div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

  <!-- Modales -->
  <div id="modalBackdrop" class="modal-backdrop hidden" aria-hidden="true"></div>

  <!-- Modal: Nuevo archivo -->
  <div id="modalNewFile" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalNewFileTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalNewFileTitle"><i class="bi bi-file-earmark-plus"></i> Nuevo archivo</h3>
        <button class="modal-close" data-modal-close><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <label class="field">
          <span>Nombre de archivo</span>
          <input type="text" id="inpNewFileName" placeholder="main.py" />
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-modal-close>Cancelar</button>
        <button class="btn primary" id="btnConfirmNewFile">Crear</button>
      </div>
    </div>
  </div>

  <!-- Modal: Renombrar -->
  <div id="modalRename" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalRenameTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalRenameTitle"><i class="bi bi-input-cursor-text"></i> Renombrar</h3>
        <button class="modal-close" data-modal-close><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <label class="field">
          <span>Nombre actual</span>
          <input type="text" id="inpOldName" disabled />
        </label>
        <label class="field">
          <span>Nuevo nombre</span>
          <input type="text" id="inpNewName" placeholder="nuevo_nombre.py" />
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-modal-close>Cancelar</button>
        <button class="btn primary" id="btnConfirmRename">Renombrar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Nueva carpeta -->
  <div id="modalNewFolder" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalNewFolderTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalNewFolderTitle"><i class="bi bi-folder-plus"></i> Nueva carpeta</h3>
        <button class="modal-close" data-modal-close><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <label class="field">
          <span>Nombre de carpeta</span>
          <input type="text" id="inpNewFolderName" placeholder="carpeta" />
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-modal-close>Cancelar</button>
        <button class="btn primary" id="btnConfirmNewFolder">Crear</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmación genérica -->
  <div id="modalConfirm" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalConfirmTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalConfirmTitle"><i class="bi bi-question-circle"></i> Confirmación</h3>
        <button class="modal-close" data-modal-close><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <p id="modalConfirmMessage">¿Seguro?</p>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" data-modal-close>Cancelar</button>
        <button class="btn danger" id="btnConfirmAccept">Aceptar</button>
      </div>
    </div>
  </div>

  <div class="app">
    <header class="logo">
      <img src="https://raw.githubusercontent.com/Maria05py/EspressIdea/57d8835712e9e47511a8b6029e10ca63f3d1f998/Assets/ESPRESSIDEA_004.svg" alt="">
    </header>

    <div class="main-container">
      <!-- Sidebar Archivos -->
      <aside class="sidebar">
        <div class="device-title">Dispositivo Python</div>
        <div class="toolbar">
          <button class="btn" id="btnRefresh" title="Refrescar"><i class="bi bi-arrow-clockwise"></i></button>
          <button class="btn" id="btnNewFile"  title="Nuevo archivo"><i class="bi bi-file-earmark-plus"></i></button>
          <button class="btn" id="btnNewFolder" title="Nueva carpeta"><i class="bi bi-folder-plus"></i></button>
          <button class="btn" id="btnRename" title="Renombrar"><i class="bi bi-input-cursor-text"></i></button>
          <button class="btn" id="btnDelete" title="Eliminar"><i class="bi bi-trash3"></i></button>
          <button class="btn" id="btnInfo" title="Info"><i class="bi bi-info-circle"></i></button>
        </div>

        <!-- Skeleton + lista -->
        <div id="fileTreeSkeleton" class="skeleton-list">
          <div class="sk-line"></div>
          <div class="sk-line"></div>
          <div class="sk-line"></div>
        </div>
        <ul class="file-tree" id="fileTree" aria-label="Árbol de archivos"></ul>
      </aside>

      <!-- Área principal -->
      <main class="code-area">
        <div class="tabs" id="tabsBar">
          <div class="tab active" id="activeTab"><span class="label">sin nombre</span></div>
          <div class="tab" style="display:none"><span class="close-tab">x</span></div>
        </div>

        <div class="controls">
          <button class="btn play" title="Ejecutar code.py"><i class="bi bi-play-fill"></i></button>
          <button class="btn stop" id="btnStop" title="Detener y preparar REPL"><i class="bi bi-stop-fill"></i></button>
          <button class="btn save" id="btnSave" title="Guardar archivo activo"><i class="bi bi-save"></i></button>
          <button class="btn download" id="btnDownload" title="Descargar archivo activo"><i class="bi bi-download"></i></button>
          <button class="btn upload" id="btnUpload" title="Subir archivo a carpeta actual"><i class="bi bi-upload"></i></button>
          <button class="tag red" id="tagAI">IA</button>
        </div>

        <div class="editor-window">
          <!-- Skeleton editor -->
          <div id="editorSkeleton" class="skeleton-code">
            <div class="sk-row"></div>
            <div class="sk-row"></div>
            <div class="sk-row short"></div>
          </div>
          <textarea id="codeEditor" spellcheck="false" placeholder="# Selecciona un archivo para editarlo"></textarea>
        </div>

        <!-- Consola -->
        <div class="console">
          <div class="console-header">
            <span class="dot red"></span>
            <span class="dot yellow"></span>
            <span class="dot green"></span>
            <span class="title">REPL CircuitPython</span>
            <span id="wsStatus" class="status badge">Conectando...</span>
          </div>
          <div id="terminal" class="console-terminal" contenteditable="true" spellcheck="false"></div>
        </div>
      </main>

      <!-- Panel derecho (chat) -->
      <aside class="right-panel">
        <div id="chatMessages" class="chat-container"></div>
        <div class="input-area">
          <input type="text" id="chatInput" placeholder="Escribe un mensaje..." />
          <button id="sendBtn">Enviar</button>
        </div>
      </aside>
    </div>
  </div>
</body>
</html>
